<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classroom</title>
    <style>
        /* Base Layout */
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            display: flex;
            min-height: 100vh;
            background-color: #f5f5f5;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background-color: #157F93;
            color: white;
            flex-shrink: 0;
            height: 100vh;
            overflow-y: auto;
            position: sticky;
            top: 0;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-title {
            font-size: 18px;
            margin: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-item {
            position: relative;
            margin-bottom: 5px;
        }

        .sidebar-link {
            display: block;
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }

        .sidebar-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .sidebar-link.active {
            background-color: rgba(255, 255, 255, 0.2);
            border-left: 3px solid #3498db;
        }

        .tab-actions {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            display: none;
        }

        .sidebar-item:hover .tab-actions {
            display: block;
        }

        .tab-action-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            padding: 2px 5px;
            font-size: 12px;
            transition: color 0.2s;
        }

        .tab-action-btn:hover {
            color: white;
        }

        .move-handle {
            cursor: move;
            margin-right: 5px;
            color: rgba(255, 255, 255, 0.5);
        }

        .add-tab-btn {
            background: #3498db;
            border: none;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .add-tab-btn:hover {
            background: #2980b9;
            transform: scale(1.1);
        }

        /* Main Content Styles */
        .main-content {
            flex-grow: 1;
            padding: 20px;
            max-width: calc(100% - 250px);
            box-sizing: border-box;
        }

        .header-content {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        /* Profile picture styles */
        #profile-pic {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid #007bb5;
            cursor: pointer;
            transition: transform 0.2s;
            z-index: 100;
            display: none;
            background-color: white;
        }

        #profile-pic:hover {
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        /* Drag and Drop Styles */
        .sidebar-item.dragging {
            opacity: 0.5;
            background-color: rgba(52, 152, 219, 0.2);
        }

        .sidebar-item.drop-area {
            border-top: 2px dashed #3498db;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            width: 400px;
            max-width: 90%;
        }

        .close-button {
            float: right;
            font-size: 24px;
            cursor: pointer;
        }

        .modal h2 {
            margin-top: 0;
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .button:hover {
            background-color: #2980b9;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
            gap: 10px;
        }

        /* Post Styles */
        .post-card {
            background: white;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .post-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .post-card.expanded {
            position: fixed;
            top: 0;
            left: 250px;
            right: 0;
            bottom: 0;
            z-index: 100;
            overflow-y: auto;
            margin: 0;
            padding: 40px;
            background: white;
        }

        .post-card .back-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            z-index: 101;
        }

        .post-details {
            display: none;
            margin-top: 15px;
        }

        .embed-container {
            margin: 15px 0;
        }

        .post-card .collapsed-content {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 0;
        }

        .post-card.expanded .post-details {
            display: block;
        }

        .post-card:not(.expanded) .delete-button,
        .post-card:not(.expanded) button[onclick^="editAnnouncement"] {
            display: none !important;
        }

        .post-card.expanded .delete-button,
        .post-card.expanded button[onclick^="editAnnouncement"] {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
        }

        .post-card.expanded button[onclick^="editAnnouncement"] {
            right: 100px;
        }

        /* Hide editing controls for non-admins */
        body.non-admin .add-tab-btn,
        body.non-admin .button[onclick="openAnnouncementEditor()"],
        body.non-admin .tab-actions,
        body.non-admin .post-card .delete-button,
        body.non-admin .post-card button[onclick^="editAnnouncement"] {
            display: none !important;
        }

        body.non-admin .sidebar-title {
            padding-right: 10px;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            
            .main-content {
                max-width: 100%;
            }
            
            .post-card.expanded {
                left: 0;
            }
        }
		/* Reminders Styles */
.reminders-container {
    background: white;
    border-radius: 5px;
    padding: 15px;
    margin-bottom: 20px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.reminders-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.reminders-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 15px;
}

.reminder-card {
    background: #f9f9f9;
    border-left: 4px solid #3498db;
    padding: 12px;
    border-radius: 4px;
    position: relative;
}

.reminder-card.trip {
    border-left-color: #2ecc71;
}

.reminder-card.test {
    border-left-color: #e74c3c;
}

.reminder-card.event {
    border-left-color: #f39c12;
}

.reminder-card.deadline {
    border-left-color: #9b59b6;
}

.reminder-title {
    font-weight: bold;
    margin-bottom: 5px;
}

.reminder-date {
    font-size: 0.9em;
    color: #555;
    margin-bottom: 5px;
}

.reminder-description {
    font-size: 0.9em;
    color: #666;
}

.reminder-actions {
    position: absolute;
    top: 5px;
    right: 5px;
    display: none;
}

.reminder-card:hover .reminder-actions {
    display: block;
}

.reminder-action-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 2px 5px;
    font-size: 12px;
}

/* Hide add reminder button for non-admins */
body.non-admin #add-reminder-btn {
    display: none;
}
		/* Enhanced Post Card Styles */
.post-card.expanded {
    left: 250px;
    right: 0;
    bottom: 0;
    padding: 40px;
    background: #fff;
    border-radius: 0;
    box-shadow: none;
    z-index: 100;
    overflow-y: auto;
    margin: 0;
}

.post-card.expanded h3 {
    font-size: 28px;
    color: #2c3e50;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #eee;
}

.post-card.expanded .post-details {
    display: block;
    margin-top: 25px;
    font-size: 16px;
    line-height: 1.6;
    color: #555;
}

.post-card.expanded .post-details p {
    margin-bottom: 20px;
}

.post-card.expanded .embed-container {
    margin: 30px 0;
    background: #f9f9f9;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #eee;
}

.post-card.expanded .file-attachment {
    display: inline-block;
    background: #f0f7ff;
    padding: 10px 15px;
    border-radius: 6px;
    margin-right: 10px;
    margin-bottom: 10px;
    color: #3498db;
    text-decoration: none;
    transition: all 0.2s;
}

.post-card.expanded .file-attachment:hover {
    background: #e1f0ff;
}

.post-card.expanded .post-meta {
    display: flex;
    align-items: center;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #eee;
    color: #777;
    font-size: 14px;
}

.post-card.expanded .post-actions {
    position: absolute;
    top: 40px;
    right: 40px;
    display: flex;
    gap: 10px;
}

.post-card.expanded .post-actions button {
    padding: 8px 12px;
    font-size: 13px;
    border-radius: 4px;
}

.post-card.expanded .post-actions .delete-button {
    background: #e74c3c;
}

.post-card.expanded .post-actions .delete-button:hover {
    background: #c0392b;
}
		@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');

body {
    font-family: 'Roboto', sans-serif;
    line-height: 1.6;
}

.post-content {
    font-size: 16px;
    line-height: 1.8;
    color: #444;
}

.post-content p {
    margin-bottom: 1.5em;
}
		.post-card {
    transition: all 0.3s ease, transform 0.2s ease;
}

.post-card.expanded {
    transition: all 0.4s ease;
}
		
		/* Add to your CSS */
body {
  background: #f8f9fa; /* Lighter background */
  font-family: 'Open Sans', sans-serif;
}

.sidebar {
  background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
}

h1, h2, h3 {
  font-family: 'Poppins', sans-serif;
  font-weight: 600;
}
		/* Add to your CSS */
.post-card, .reminder-card {
  transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
  box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
}

.post-card:hover, .reminder-card:hover {
  box-shadow: 0 14px 28px rgba(0,0,0,0.12), 0 10px 10px rgba(0,0,0,0.10);
  transform: translateY(-2px);
}
		/* Add to your CSS */
.input-group {
  position: relative;
  margin: 20px 0;
}

.input-group input, .input-group textarea {
  padding: 15px 10px 5px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 16px;
}

.input-group label {
  position: absolute;
  top: 15px;
  left: 10px;
  color: #999;
  pointer-events: none;
  transition: all 0.2s ease;
}

.input-group input:focus + label,
.input-group input:not(:placeholder-shown) + label,
.input-group textarea:focus + label,
.input-group textarea:not(:placeholder-shown) + label {
  top: 5px;
  font-size: 12px;
  color: #3498db;
}
		/* Add to your CSS */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.post-card {
  animation: fadeIn 0.3s ease-out forwards;
  opacity: 0;
}

.post-card:nth-child(1) { animation-delay: 0.1s; }
.post-card:nth-child(2) { animation-delay: 0.2s; }
/* etc */
		
		/* Add to your CSS */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: #f1f1f1;
}

::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #555;
}
		.sidebar-header {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 15px 20px;
}

.sidebar-logo {
    width: 50px;
    height: 50px;
    object-fit: contain;
}
		
    </style>
    <script src="https://accounts.google.com/gsi/client" async="" defer=""></script>
<style id="googleidentityservice_button_styles">.qJTHM{-webkit-user-select:none;color:#202124;direction:ltr;-webkit-touch-callout:none;font-family:"Roboto-Regular",arial,sans-serif;-webkit-font-smoothing:antialiased;font-weight:400;margin:0;overflow:hidden;-webkit-text-size-adjust:100%}.ynRLnc{left:-9999px;position:absolute;top:-9999px}.L6cTce{display:none}.bltWBb{word-break:break-all}.hSRGPd{color:#1a73e8;cursor:pointer;font-weight:500;text-decoration:none}.Bz112c-W3lGp{height:16px;width:16px}.Bz112c-E3DyYd{height:20px;width:20px}.Bz112c-r9oPif{height:24px;width:24px}.Bz112c-u2z5K{height:36px;width:36px}.Bz112c-uaxL4e{-webkit-border-radius:10px;border-radius:10px}.LgbsSe-Bz112c{display:block}.S9gUrf-YoZ4jf,.S9gUrf-YoZ4jf *{border:none;margin:0;padding:0}.fFW7wc-ibnC6b>.aZ2wEe>div{border-color:#4285f4}.P1ekSe-ZMv3u>div:nth-child(1){background-color:#1a73e8!important}.P1ekSe-ZMv3u>div:nth-child(2),.P1ekSe-ZMv3u>div:nth-child(3){background-image:linear-gradient(to right,rgba(255,255,255,.7),rgba(255,255,255,.7)),linear-gradient(to right,#1a73e8,#1a73e8)!important}.haAclf{display:inline-block}.nsm7Bb-HzV7m-LgbsSe{-webkit-border-radius:4px;border-radius:4px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-transition:background-color .218s,border-color .218s;transition:background-color .218s,border-color .218s;-webkit-user-select:none;-webkit-appearance:none;background-color:#fff;background-image:none;border:1px solid #dadce0;color:#3c4043;cursor:pointer;font-family:"Google Sans",arial,sans-serif;font-size:14px;height:40px;letter-spacing:0.25px;outline:none;overflow:hidden;padding:0 12px;position:relative;text-align:center;vertical-align:middle;white-space:nowrap;width:auto}@media screen and (-ms-high-contrast:active){.nsm7Bb-HzV7m-LgbsSe{border:2px solid windowText;color:windowText}}@media screen and (preferes-contrast:more){.nsm7Bb-HzV7m-LgbsSe{color:#000}}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe{font-size:14px;height:32px;letter-spacing:0.25px;padding:0 10px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe{font-size:11px;height:20px;letter-spacing:0.3px;padding:0 8px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe{padding:0;width:40px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.pSzOP-SxQuSe{width:32px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.purZT-SxQuSe{width:20px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK{-webkit-border-radius:20px;border-radius:20px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK.pSzOP-SxQuSe{-webkit-border-radius:16px;border-radius:16px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK.purZT-SxQuSe{-webkit-border-radius:10px;border-radius:10px}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc{border:none;color:#fff}.nsm7Bb-HzV7m-LgbsSe.MFS4be-v3pZbf-Ia7Qfc{background-color:#1a73e8}.nsm7Bb-HzV7m-LgbsSe.MFS4be-JaPV2b-Ia7Qfc{background-color:#202124;color:#e8eaed}@media screen and (prefers-contrast:more){.nsm7Bb-HzV7m-LgbsSe.MFS4be-JaPV2b-Ia7Qfc{color:#fff}}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:18px;margin-right:8px;min-width:18px;width:18px}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:14px;min-width:14px;width:14px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:10px;min-width:10px;width:10px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin-left:8px;margin-right:-4px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin:0;padding:10px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{padding:8px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{padding:4px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{-webkit-border-top-left-radius:3px;border-top-left-radius:3px;-webkit-border-bottom-left-radius:3px;border-bottom-left-radius:3px;display:-webkit-box;display:-webkit-flex;display:flex;justify-content:center;-webkit-align-items:center;align-items:center;background-color:#fff;height:36px;margin-left:-10px;margin-right:12px;min-width:36px;width:36px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf .nsm7Bb-HzV7m-LgbsSe-Bz112c,.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin:0;padding:0}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{height:28px;margin-left:-8px;margin-right:10px;min-width:28px;width:28px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{height:16px;margin-left:-6px;margin-right:8px;min-width:16px;width:16px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{-webkit-border-radius:3px;border-radius:3px;margin-left:2px;margin-right:0;padding:0}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{-webkit-border-radius:18px;border-radius:18px}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{-webkit-border-radius:14px;border-radius:14px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{-webkit-border-radius:8px;border-radius:8px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-bN97Pc-sM5MNb{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center;-webkit-flex-direction:row;flex-direction:row;justify-content:space-between;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;height:100%;position:relative;width:100%}.nsm7Bb-HzV7m-LgbsSe .oXtfBe-l4eHX{justify-content:center}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-BPrWId{-webkit-flex-grow:1;flex-grow:1;font-family:"Google Sans",arial,sans-serif;font-weight:500;overflow:hidden;text-overflow:ellipsis;vertical-align:top}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-BPrWId{font-weight:300}.nsm7Bb-HzV7m-LgbsSe .oXtfBe-l4eHX .nsm7Bb-HzV7m-LgbsSe-BPrWId{-webkit-flex-grow:0;flex-grow:0}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-MJoBVe{-webkit-transition:background-color .218s;transition:background-color .218s;bottom:0;left:0;position:absolute;right:0;top:0}.nsm7Bb-HzV7m-LgbsSe:hover,.nsm7Bb-HzV7m-LgbsSe:focus{-webkit-box-shadow:none;box-shadow:none;border-color:rgb(210,227,252);outline:none}.nsm7Bb-HzV7m-LgbsSe:focus-within{outline:2px solid #00639b;border-color:transparent}.nsm7Bb-HzV7m-LgbsSe:hover .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(66,133,244,.08)}.nsm7Bb-HzV7m-LgbsSe:active .nsm7Bb-HzV7m-LgbsSe-MJoBVe,.nsm7Bb-HzV7m-LgbsSe:focus .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(66,133,244,.1)}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:hover .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(255,255,255,.24)}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:active .nsm7Bb-HzV7m-LgbsSe-MJoBVe,.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:focus .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(255,255,255,.32)}.nsm7Bb-HzV7m-LgbsSe .n1UuX-DkfjY{-webkit-border-radius:50%;border-radius:50%;display:-webkit-box;display:-webkit-flex;display:flex;height:20px;margin-left:-4px;margin-right:8px;min-width:20px;width:20px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId{font-family:"Roboto";font-size:12px;text-align:left}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .ssJRIf,.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff .fmcmS{overflow:hidden;text-overflow:ellipsis}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center;color:#5f6368;fill:#5f6368;font-size:11px;font-weight:400}.nsm7Bb-HzV7m-LgbsSe.jVeSEe.MFS4be-Ia7Qfc .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{color:#e8eaed;fill:#e8eaed}@media screen and (prefers-contrast:more){.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff,.nsm7Bb-HzV7m-LgbsSe.jVeSEe.MFS4be-Ia7Qfc .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{color:#000;fill:#000}}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff .Bz112c{height:18px;margin:-3px -3px -3px 2px;min-width:18px;width:18px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{-webkit-border-top-left-radius:0;border-top-left-radius:0;-webkit-border-bottom-left-radius:0;border-bottom-left-radius:0;-webkit-border-top-right-radius:3px;border-top-right-radius:3px;-webkit-border-bottom-right-radius:3px;border-bottom-right-radius:3px;margin-left:12px;margin-right:-10px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{-webkit-border-radius:18px;border-radius:18px}.L5Fo6c-sM5MNb{border:0;display:block;left:0;position:relative;top:0}.L5Fo6c-bF1uUb{-webkit-border-radius:4px;border-radius:4px;bottom:0;cursor:pointer;left:0;position:absolute;right:0;top:0}.L5Fo6c-bF1uUb:focus{border:none;outline:none}sentinel{}</style><link id="googleidentityservice" type="text/css" media="all" href="https://accounts.google.com/gsi/style" rel="stylesheet"><meta http-equiv="origin-trial" content="A8o5T4MyEkRZqLA9WeG2XTFdV5tsX2Prg85xyQ+RL1btVuybB1K/EQ+7JUsPK+J32oBMTnsoF9B4A+qTlL6efgQAAABweyJvcmlnaW4iOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb206NDQzIiwiZmVhdHVyZSI6IkZlZENtQnV0dG9uTW9kZSIsImV4cGlyeSI6MTc0NDY3NTIwMCwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><meta http-equiv="origin-trial" content="A0bwwYX3EzD2AQ197RMA+kffyE2vepCTH00bYuzg+GBcNrCLbr5oXzOvpk5eehvvaGr9Mu+/rH9pKPJXR76MngoAAAB2eyJvcmlnaW4iOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb206NDQzIiwiZmVhdHVyZSI6IkZlZENtQ29udGludWVPbkJ1bmRsZSIsImV4cGlyeSI6MTc0NDY3NTIwMCwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="></head>
<body class="non-admin">
    <!-- Profile Picture Element -->
    <img id="profile-pic" src="" alt="Profile Picture">

    <!-- Sidebar -->
    <aside class="sidebar">
     <div class="sidebar-header">
    <img src="https://projectspace.nz/ujalvxpj/Main/Official%20Website/Content/Drawing-12.sketchpad%20(1).png" alt="Logo" class="sidebar-logo">
    <h2 class="sidebar-title">Navigation
        <button class="add-tab-btn" title="Add New Tab" onclick="openTabEditor()">+</button>
    </h2>
</div>
        <ul class="sidebar-menu" id="sidebar-menu"><li class="sidebar-item" data-tab-id="term1" draggable="false">
                    <a href="#" class="sidebar-link active">
                        Term 1
                        
                    </a>
                </li><li class="sidebar-item" data-tab-id="term2" draggable="false">
                    <a href="#" class="sidebar-link ">
                        Term 2
                        
                    </a>
                </li><li class="sidebar-item" data-tab-id="term3" draggable="false">
                    <a href="#" class="sidebar-link ">
                        Term 3
                        
                    </a>
                </li><li class="sidebar-item" data-tab-id="term4" draggable="false">
                    <a href="#" class="sidebar-link ">
                        Term 4
                        
                    </a>
                </li></ul>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header class="header-content">
			
			
			<!-- Reminders Panel -->
<div class="reminders-container">
    <div class="reminders-header">
        <h2>Upcoming Reminders</h2>
        <button class="button" onclick="openReminderEditor()" id="add-reminder-btn">+ Add Reminder</button>
    </div>
    <div class="reminders-list" id="reminders-list">
        <!-- Reminders will be added here dynamically -->
    </div>
</div>

<!-- Reminder Editor Modal -->
<div id="reminder-editor" class="modal">
    <div class="modal-content">
        <span class="close-button" onclick="closeReminderEditor()">×</span>
        <h2 id="reminder-editor-title">Add New Reminder</h2>
        <input type="text" id="reminder-title" placeholder="Reminder Title">
        <textarea id="reminder-description" placeholder="Description (optional)"></textarea>
        <input type="date" id="reminder-date">
        <select id="reminder-type">
            <option value="trip">Field Trip</option>
            <option value="test">Internal</option>
            <option value="event">External</option>
            <option value="deadline">Deadline</option>
        </select>
        <div class="modal-buttons">
            <button class="button" onclick="closeReminderEditor()">Cancel</button>
            <button class="button" id="save-reminder-button" onclick="saveReminder()">Save</button>
        </div>
    </div>
</div>
            <h1 id="current-tab-title">Term 1</h1>
            <button class="button" onclick="openAnnouncementEditor()">Create Announcement</button>
        </header>

        <!-- Announcement Editor Modal -->
        <div id="announcement-editor" class="modal">
            <div class="modal-content">
                <span class="close-button" onclick="closeAnnouncementEditor()">×</span>
                <h2>Create New Announcement</h2>
                <input type="text" id="announcement-title" placeholder="Announcement Title">
                <textarea id="announcement-content" placeholder="Write your announcement here..."></textarea>
                <div class="upload-area">
                    <label for="file-upload" class="upload-button">Upload Files</label>
                    <input type="file" id="file-upload" multiple="" style="display:none;">
                    <div id="uploaded-files"></div>
                </div>
                <textarea id="embed-code" placeholder="Paste embed code for Google Slides, Docs, etc. here (optional)"></textarea>
                <button class="button" id="save-announcement-button">Post Announcement</button>
            </div>
        </div>

        <!-- Posts Feed -->
        <div class="classroom-info">
            <div class="posts-feed" id="posts-feed"></div>
        </div>
    </main>

    <!-- Tab Editor Modal -->
    <div id="tab-editor-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeTabEditor()">×</span>
            <h2 id="tab-editor-title">Add New Tab</h2>
            <input type="text" id="tab-name-input" placeholder="Tab Name">
            <div class="modal-buttons">
                <button class="button" onclick="closeTabEditor()">Cancel</button>
                <button class="button" id="save-tab-button" onclick="saveTab()">Save</button>
            </div>
        </div>
    </div>

    <script>
     // DOM Elements
const sidebarMenu = document.getElementById('sidebar-menu');
const tabEditorModal = document.getElementById('tab-editor-modal');
const tabNameInput = document.getElementById('tab-name-input');
const saveTabButton = document.getElementById('save-tab-button');
const profilePicElement = document.getElementById('profile-pic');
const currentTabTitleElement = document.getElementById('current-tab-title');

// Announcement-related elements
const announcementEditor = document.getElementById('announcement-editor');
const postsFeed = document.getElementById('posts-feed');
const announcementTitleInput = document.getElementById('announcement-title');
const announcementContentInput = document.getElementById('announcement-content');
const fileUploadInput = document.getElementById('file-upload');
const uploadedFilesDiv = document.getElementById('uploaded-files');
const embedCodeInput = document.getElementById('embed-code');

// Variables
let tabs = [];
let currentTabId = null;
let currentTabBeingEdited = null;
let uploadedFiles = [];
let expandedPost = null;
let reminders = [];
let currentReminderBeingEdited = null;

// Firebase configuration (replace with your actual config)
const firebaseConfig = {
  apiKey: "AIzaSyCSTEJ3LevxY2_rlGROzajNnNBrVG3oRR4",
  authDomain: "gdchub-3b40a.firebaseapp.com",
  databaseURL: "https://gdchub-3b40a-default-rtdb.firebaseio.com",
  projectId: "gdchub-3b40a",
  storageBucket: "gdchub-3b40a.appspot.com", // Fixed storage bucket format
  messagingSenderId: "399894468887",
  appId: "1:399894468887:web:e3b8669a038fec20d9bf52"
};
// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

// Admin configuration
const ADMIN_EMAILS = ['fadekeyvids@gmail.com']; // Add more admin emails as needed
let isAdmin = false;
let currentUser = null;

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    initFirebaseAuth();
    setupDragAndDrop();
});

// Firebase Auth initialization
function initFirebaseAuth() {
    firebase.auth().onAuthStateChanged(user => {
        if (user) {
            currentUser = user;
            checkUserProfile(user);
            loadAllData();
        } else {
            // No user is signed in, show login
            currentUser = null;
            showLogin();
        }
    });
}

function showLogin() {
    // Show login UI (you can implement Google Sign-In here)
    // For now, we'll just redirect to login
    window.location.href = "login.html";
}

// Check and load user profile picture and permissions
function checkUserProfile(user) {
    if (user.photoURL) {
        profilePicElement.src = user.photoURL;
        profilePicElement.style.display = 'block';
    }
    
    // Check if user is admin
    if (user.email && ADMIN_EMAILS.includes(user.email.toLowerCase())) {
        isAdmin = true;
        document.body.classList.remove('non-admin');
    } else {
        isAdmin = false;
        document.body.classList.add('non-admin');
    }
}

// Load all data from Firestore
function loadAllData() {
    loadTabs();
    loadReminders();
}

// TAB MANAGEMENT
async function loadTabs() {
    try {
        const snapshot = await db.collection('tabs').orderBy('order').get();
        tabs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        
        renderTabs();
        
        // Set first tab as active by default if none is selected
        if (tabs.length > 0 && !currentTabId) {
            setActiveTab(tabs[0].id);
        }
    } catch (error) {
        console.error("Error loading tabs:", error);
        showError("Failed to load tabs. Please refresh the page.");
    }
}

async function saveTab(tabData) {
    try {
        if (tabData.id) {
            // Update existing tab
            await db.collection('tabs').doc(tabData.id).update({
                name: tabData.name,
                order: tabData.order
            });
        } else {
            // Create new tab
            const docRef = await db.collection('tabs').add({
                name: tabData.name,
                order: tabData.order || tabs.length + 1
            });
            tabData.id = docRef.id;
        }
        return tabData;
    } catch (error) {
        console.error("Error saving tab:", error);
        throw error;
    }
}

async function deleteTabFromDB(tabId) {
    try {
        // Delete the tab's announcements first
        const announcementsSnapshot = await db.collection('announcements')
            .where('tabId', '==', tabId)
            .get();
        
        const batch = db.batch();
        announcementsSnapshot.forEach(doc => {
            batch.delete(doc.ref);
        });
        await batch.commit();
        
        // Now delete the tab
        await db.collection('tabs').doc(tabId).delete();
    } catch (error) {
        console.error("Error deleting tab:", error);
        throw error;
    }
}

function renderTabs() {
    sidebarMenu.innerHTML = '';
    
    tabs.forEach(tab => {
        const tabItem = document.createElement('li');
        tabItem.className = 'sidebar-item';
        tabItem.dataset.tabId = tab.id;
        tabItem.draggable = isAdmin; // Only draggable for admins
        
        const actionsHtml = isAdmin ? 
            `<div class="tab-actions">
                <button class="tab-action-btn" title="Edit" onclick="editTab('${tab.id}')">
                    ✏️
                </button>
                <button class="tab-action-btn" title="Delete" onclick="deleteTab('${tab.id}')">
                    🗑️
                </button>
            </div>` : '';
        
        tabItem.innerHTML = `
            <a href="#" class="sidebar-link ${tab.id === currentTabId ? 'active' : ''}">
                ${isAdmin ? '<span class="move-handle">☰</span> ' : ''}${tab.name}
                ${actionsHtml}
            </a>
        `;
        
        tabItem.addEventListener('click', (e) => {
            if (!e.target.closest('.tab-action-btn')) {
                e.preventDefault();
                setActiveTab(tab.id);
            }
        });
        
        // Only set up drag and drop for admins
        if (isAdmin) {
            tabItem.addEventListener('dragstart', handleDragStart);
            tabItem.addEventListener('dragover', handleDragOver);
            tabItem.addEventListener('dragleave', handleDragLeave);
            tabItem.addEventListener('drop', handleDrop);
            tabItem.addEventListener('dragend', handleDragEnd);
        }
        
        sidebarMenu.appendChild(tabItem);
    });
}

// DRAG AND DROP FUNCTIONS (same as before)
function setupDragAndDrop() {
    // These are now handled by individual event listeners on each tab item
}

function handleDragStart(e) {
    if (!isAdmin) return;
    draggedItem = this;
    this.classList.add('dragging');
    e.dataTransfer.effectAllowed = 'move';
    e.dataTransfer.setData('text/html', this.innerHTML);
}

function handleDragOver(e) {
    if (!isAdmin) return;
    e.preventDefault();
    this.classList.add('drop-area');
    e.dataTransfer.dropEffect = 'move';
}

function handleDragLeave() {
    if (!isAdmin) return;
    this.classList.remove('drop-area');
}

async function handleDrop(e) {
    if (!isAdmin) return;
    e.preventDefault();
    this.classList.remove('drop-area');
    
    if (draggedItem !== this) {
        // Get the IDs of the dragged item and the drop target
        const draggedId = draggedItem.dataset.tabId;
        const targetId = this.dataset.tabId;
        
        // Find the indexes of these items in the tabs array
        const draggedIndex = tabs.findIndex(tab => tab.id === draggedId);
        const targetIndex = tabs.findIndex(tab => tab.id === targetId);
        
        if (draggedIndex !== -1 && targetIndex !== -1) {
            // Remove the dragged item from its current position
            const [removed] = tabs.splice(draggedIndex, 1);
            
            // Insert it before the target item
            tabs.splice(targetIndex, 0, removed);
            
            // Update the order property based on new positions
            tabs.forEach((tab, index) => {
                tab.order = index + 1;
            });
            
            // Save new order to database
            try {
                const batch = db.batch();
                tabs.forEach(tab => {
                    const tabRef = db.collection('tabs').doc(tab.id);
                    batch.update(tabRef, { order: tab.order });
                });
                await batch.commit();
                renderTabs();
            } catch (error) {
                console.error("Error updating tab order:", error);
                showError("Failed to update tab order. Please try again.");
                // Reload tabs to reset to correct state
                loadTabs();
            }
        }
    }
}

function handleDragEnd() {
    if (!isAdmin) return;
    this.classList.remove('dragging');
    document.querySelectorAll('.sidebar-item').forEach(item => {
        item.classList.remove('drop-area');
    });
}

function setActiveTab(tabId) {
    currentTabId = tabId;
    const tab = tabs.find(t => t.id === tabId);
    
    if (tab) {
        currentTabTitleElement.textContent = tab.name;
        
        // Update active state in sidebar
        document.querySelectorAll('.sidebar-link').forEach(link => {
            link.classList.remove('active');
        });
        
        const activeLink = document.querySelector(`.sidebar-item[data-tab-id="${tabId}"] .sidebar-link`);
        if (activeLink) {
            activeLink.classList.add('active');
        }
        
        // Load announcements for this tab
        loadAnnouncementsForTab(tabId);
    }
}

// ANNOUNCEMENTS MANAGEMENT
async function loadAnnouncementsForTab(tabId) {
    try {
        const snapshot = await db.collection('announcements')
            .where('tabId', '==', tabId)
            .orderBy('createdAt', 'desc')
            .get();
        
        postsFeed.innerHTML = '';
        
        snapshot.forEach(doc => {
            const announcement = { id: doc.id, ...doc.data() };
            postsFeed.appendChild(createPostElement(announcement));
        });
    } catch (error) {
        console.error("Error loading announcements:", error);
        showError("Failed to load announcements. Please refresh the page.");
    }
}

async function saveAnnouncement(announcementData) {
    try {
        if (announcementData.id) {
            // Update existing announcement
            await db.collection('announcements').doc(announcementData.id).update({
                title: announcementData.title,
                content: announcementData.content,
                embedCode: announcementData.embedCode,
                files: announcementData.files,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            return announcementData.id;
        } else {
            // Create new announcement
            const docRef = await db.collection('announcements').add({
                tabId: currentTabId,
                title: announcementData.title,
                content: announcementData.content,
                embedCode: announcementData.embedCode,
                files: announcementData.files,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            return docRef.id;
        }
    } catch (error) {
        console.error("Error saving announcement:", error);
        throw error;
    }
}

async function deleteAnnouncementFromDB(announcementId) {
    try {
        await db.collection('announcements').doc(announcementId).delete();
    } catch (error) {
        console.error("Error deleting announcement:", error);
        throw error;
    }
}

function createPostElement(announcement) {
    const post = document.createElement('div');
    post.classList.add('post-card');
    post.setAttribute('data-id', announcement.id);
    
    // Format date
    const postDate = announcement.createdAt?.toDate() || new Date();
    const formattedDate = postDate.toLocaleDateString('en-US', {
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
    
    // File attachments HTML
    const filesHtml = announcement.files?.map(file => 
        `<a href="${file.url}" class="file-attachment" target="_blank" download="${file.name}">
            <i class="file-icon">📄</i> ${file.name}
        </a>`
    ).join('') || '';
    
    // Actions HTML (for admins only)
    const actionsHtml = isAdmin ? 
        `<div class="post-actions">
            <button class="button" onclick="event.stopPropagation(); editAnnouncement('${announcement.id}')">
                Edit
            </button>
            <button class="button delete-button" onclick="event.stopPropagation(); deleteAnnouncement('${announcement.id}')">
                Delete
            </button>
        </div>` : '';
    
    post.innerHTML = `
        ${actionsHtml}
        <h3>${announcement.title}</h3>
        <div class="collapsed-content">${announcement.content}</div>
        <div class="post-details">
            <div class="post-content">${announcement.content}</div>
            ${announcement.embedCode ? 
                `<div class="embed-container">${announcement.embedCode}</div>` : ''}
            ${announcement.files?.length > 0 ? 
                `<div class="file-attachments">${filesHtml}</div>` : ''}
            <div class="post-meta">
                Posted on ${formattedDate}
            </div>
        </div>`;
    
    post.addEventListener('click', () => expandPost(post));
    return post;
}

// REMINDERS MANAGEMENT
async function loadReminders() {
    try {
        const snapshot = await db.collection('reminders')
            .orderBy('date')
            .get();
        
        reminders = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        renderReminders();
    } catch (error) {
        console.error("Error loading reminders:", error);
        showError("Failed to load reminders. Please refresh the page.");
    }
}

async function saveReminderToDB(reminderData) {
    try {
        if (reminderData.id) {
            // Update existing reminder
            await db.collection('reminders').doc(reminderData.id).update({
                title: reminderData.title,
                description: reminderData.description,
                date: reminderData.date,
                type: reminderData.type
            });
            return reminderData.id;
        } else {
            // Create new reminder
            const docRef = await db.collection('reminders').add({
                title: reminderData.title,
                description: reminderData.description,
                date: reminderData.date,
                type: reminderData.type,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            return docRef.id;
        }
    } catch (error) {
        console.error("Error saving reminder:", error);
        throw error;
    }
}

async function deleteReminderFromDB(reminderId) {
    try {
        await db.collection('reminders').doc(reminderId).delete();
    } catch (error) {
        console.error("Error deleting reminder:", error);
        throw error;
    }
}

function renderReminders() {
    const remindersList = document.getElementById('reminders-list');
    remindersList.innerHTML = '';
    
    reminders.forEach(reminder => {
        const reminderElement = document.createElement('div');
        reminderElement.className = `reminder-card ${reminder.type}`;
        reminderElement.dataset.id = reminder.id;
        
        const actionsHtml = isAdmin ? 
            `<div class="reminder-actions">
                <button class="reminder-action-btn" onclick="editReminder('${reminder.id}')">✏️</button>
                <button class="reminder-action-btn" onclick="deleteReminder('${reminder.id}')">🗑️</button>
            </div>` : '';
        
        reminderElement.innerHTML = `
            ${actionsHtml}
            <div class="reminder-title">${reminder.title}</div>
            <div class="reminder-date">${formatDate(reminder.date)}</div>
            ${reminder.description ? `<div class="reminder-description">${reminder.description}</div>` : ''}
        `;
        
        remindersList.appendChild(reminderElement);
    });
}

function formatDate(dateString) {
    const date = new Date(dateString);
    const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
    return date.toLocaleDateString(undefined, options);
}

// FILE UPLOAD MANAGEMENT
async function uploadFile(file) {
    try {
        // Create a storage reference
        const storageRef = storage.ref();
        const fileRef = storageRef.child(`announcements/${currentTabId}/${Date.now()}_${file.name}`);
        
        // Upload the file
        const uploadTask = fileRef.put(file);
        
        // Wait for upload to complete
        const snapshot = await uploadTask;
        
        // Get download URL
        const downloadURL = await snapshot.ref.getDownloadURL();
        
        return {
            name: file.name,
            url: downloadURL,
            type: file.type,
            size: file.size
        };
    } catch (error) {
        console.error("Error uploading file:", error);
        throw error;
    }
}

// UI FUNCTIONS (same as before with database integration)
function openTabEditor(tabId = null) {
    if (!isAdmin) return;
    tabEditorModal.style.display = 'flex';
    tabNameInput.value = '';
    
    if (tabId) {
        // Editing existing tab
        currentTabBeingEdited = tabId;
        const tab = tabs.find(t => t.id === tabId);
        if (tab) {
            tabNameInput.value = tab.name;
            document.getElementById('tab-editor-title').textContent = 'Edit Tab';
            saveTabButton.textContent = 'Save Changes';
        }
    } else {
        // Adding new tab
        currentTabBeingEdited = null;
        document.getElementById('tab-editor-title').textContent = 'Add New Tab';
        saveTabButton.textContent = 'Add Tab';
    }
}

function closeTabEditor() {
    tabEditorModal.style.display = 'none';
    currentTabBeingEdited = null;
}

async function saveTab() {
    if (!isAdmin) return;
    const tabName = tabNameInput.value.trim();
    if (!tabName) {
        alert('Please enter a tab name');
        return;
    }
    
    try {
        if (currentTabBeingEdited) {
            // Update existing tab
            const tabIndex = tabs.findIndex(t => t.id === currentTabBeingEdited);
            if (tabIndex !== -1) {
                const updatedTab = await saveTab({
                    id: currentTabBeingEdited,
                    name: tabName,
                    order: tabs[tabIndex].order
                });
                
                tabs[tabIndex] = updatedTab;
                renderTabs();
                
                // Update title if this is the current tab
                if (currentTabBeingEdited === currentTabId) {
                    currentTabTitleElement.textContent = tabName;
                }
            }
        } else {
            // Create new tab
            const newTab = await saveTab({
                name: tabName,
                order: tabs.length + 1
            });
            
            tabs.push(newTab);
            renderTabs();
            
            // Set the new tab as active
            setActiveTab(newTab.id);
        }
        
        closeTabEditor();
    } catch (error) {
        console.error("Error saving tab:", error);
        showError("Failed to save tab. Please try again.");
    }
}

function editTab(tabId) {
    if (!isAdmin) return;
    event.stopPropagation();
    openTabEditor(tabId);
}

async function deleteTab(tabId) {
    if (!isAdmin) return;
    event.stopPropagation();
    if (confirm('Are you sure you want to delete this tab and all its announcements?')) {
        try {
            await deleteTabFromDB(tabId);
            
            // Remove the tab from local state
            tabs = tabs.filter(t => t.id !== tabId);
            
            // If we deleted the current tab, switch to the first available tab
            if (tabId === currentTabId) {
                if (tabs.length > 0) {
                    setActiveTab(tabs[0].id);
                } else {
                    currentTabId = null;
                    currentTabTitleElement.textContent = 'Classroom';
                    postsFeed.innerHTML = '';
                }
            }
            
            renderTabs();
        } catch (error) {
            console.error("Error deleting tab:", error);
            showError("Failed to delete tab. Please try again.");
        }
    }
}

function openAnnouncementEditor(announcementId = null) {
    if (!isAdmin || !currentTabId) return;
    announcementEditor.style.display = 'flex';
    announcementTitleInput.value = '';
    announcementContentInput.value = '';
    embedCodeInput.value = '';
    uploadedFiles = [];
    uploadedFilesDiv.innerHTML = '';
    
    const saveButton = document.getElementById('save-announcement-button');
    saveButton.onclick = postAnnouncement;
    saveButton.textContent = 'Post Announcement';
    
    if (announcementId) {
        // Load announcement data for editing
        db.collection('announcements').doc(announcementId).get()
            .then(doc => {
                if (doc.exists) {
                    const announcement = doc.data();
                    announcementTitleInput.value = announcement.title;
                    announcementContentInput.value = announcement.content;
                    embedCodeInput.value = announcement.embedCode || '';
                    uploadedFiles = announcement.files || [];
                    
                    uploadedFilesDiv.innerHTML = uploadedFiles.map(file => 
                        `<span>${file.name} <button class="remove-file" onclick="removeTempFile(this.parentNode, '${file.name}')">×</button></span>`
                    ).join('');
                    
                    saveButton.onclick = () => saveEditedAnnouncement(announcementId);
                    saveButton.textContent = 'Save Changes';
                }
            })
            .catch(error => {
                console.error("Error loading announcement:", error);
                showError("Failed to load announcement for editing.");
                closeAnnouncementEditor();
            });
    }
}

function closeAnnouncementEditor() {
    announcementEditor.style.display = 'none';
}

async function postAnnouncement() {
    if (!isAdmin || !currentTabId) return;
    const title = announcementTitleInput.value.trim();
    const content = announcementContentInput.value.trim();
    const embedCode = embedCodeInput.value.trim();
    
    if (!title || (!content && !embedCode)) {
        alert('Please enter a title and either content or embed code for your announcement.');
        return;
    }
    
    try {
        // Upload files first if any
        const filesToUpload = Array.from(fileUploadInput.files);
        const uploadedFileData = [];
        
        for (const file of filesToUpload) {
            const fileData = await uploadFile(file);
            uploadedFileData.push(fileData);
        }
        
        // Combine with existing files (for edits)
        const allFiles = [...uploadedFiles, ...uploadedFileData];
        
        // Save announcement
        const announcementData = {
            title,
            content,
            files: allFiles,
            embedCode
        };
        
        const announcementId = await saveAnnouncement(announcementData);
        
        // Add to UI
        const newAnnouncement = {
            id: announcementId,
            ...announcementData,
            createdAt: new Date()
        };
        
        postsFeed.insertAdjacentElement('afterbegin', createPostElement(newAnnouncement));
        closeAnnouncementEditor();
    } catch (error) {
        console.error("Error posting announcement:", error);
        showError("Failed to post announcement. Please try again.");
    }
}

async function saveEditedAnnouncement(announcementId) {
    if (!isAdmin || !currentTabId) return;
    const title = announcementTitleInput.value.trim();
    const content = announcementContentInput.value.trim();
    const embedCode = embedCodeInput.value.trim();
    
    if (!title || (!content && !embedCode)) {
        alert('Please enter a title and either content or embed code for your announcement.');
        return;
    }
    
    try {
        // Upload new files if any
        const filesToUpload = Array.from(fileUploadInput.files);
        const uploadedFileData = [];
        
        for (const file of filesToUpload) {
            const fileData = await uploadFile(file);
            uploadedFileData.push(fileData);
        }
        
        // Combine with existing files (excluding any that were removed)
        const allFiles = [...uploadedFiles, ...uploadedFileData];
        
        // Update announcement
        const announcementData = {
            title,
            content,
            files: allFiles,
            embedCode
        };
        
        await saveAnnouncement({ ...announcementData, id: announcementId });
        
        // Refresh the announcements list
        loadAnnouncementsForTab(currentTabId);
        closeAnnouncementEditor();
    } catch (error) {
        console.error("Error saving announcement:", error);
        showError("Failed to save announcement. Please try again.");
    }
}

async function deleteAnnouncement(announcementId) {
    if (!isAdmin || !currentTabId) return;
    if (confirm('Are you sure you want to delete this announcement?')) {
        try {
            await deleteAnnouncementFromDB(announcementId);
            
            const postToRemove = document.querySelector(`.post-card[data-id="${announcementId}"]`);
            if (postToRemove) {
                postToRemove.remove();
            }
        } catch (error) {
            console.error("Error deleting announcement:", error);
            showError("Failed to delete announcement. Please try again.");
        }
    }
}

function removeTempFile(element, fileName) {
    if (!isAdmin) return;
    uploadedFiles = uploadedFiles.filter(f => f.name !== fileName);
    element.remove();
}

// REMINDER UI FUNCTIONS
function openReminderEditor(reminderId = null) {
    if (!isAdmin) return;
    document.getElementById('reminder-editor').style.display = 'flex';
    document.getElementById('reminder-title').value = '';
    document.getElementById('reminder-description').value = '';
    document.getElementById('reminder-date').value = '';
    document.getElementById('reminder-type').value = 'trip';
    
    if (reminderId) {
        currentReminderBeingEdited = reminderId;
        const reminder = reminders.find(r => r.id === reminderId);
        if (reminder) {
            document.getElementById('reminder-editor-title').textContent = 'Edit Reminder';
            document.getElementById('reminder-title').value = reminder.title;
            document.getElementById('reminder-description').value = reminder.description || '';
            document.getElementById('reminder-date').value = reminder.date;
            document.getElementById('reminder-type').value = reminder.type;
            document.getElementById('save-reminder-button').textContent = 'Save Changes';
        }
    } else {
        currentReminderBeingEdited = null;
        document.getElementById('reminder-editor-title').textContent = 'Add New Reminder';
        document.getElementById('save-reminder-button').textContent = 'Add Reminder';
        // Set default date to tomorrow
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        document.getElementById('reminder-date').value = tomorrow.toISOString().split('T')[0];
    }
}

function closeReminderEditor() {
    document.getElementById('reminder-editor').style.display = 'none';
    currentReminderBeingEdited = null;
}

async function saveReminder() {
    if (!isAdmin) return;
    const title = document.getElementById('reminder-title').value.trim();
    const description = document.getElementById('reminder-description').value.trim();
    const date = document.getElementById('reminder-date').value;
    const type = document.getElementById('reminder-type').value;
    
    if (!title || !date) {
        alert('Please enter a title and date for the reminder');
        return;
    }
    
    try {
        const reminderData = {
            id: currentReminderBeingEdited,
            title,
            description,
            date,
            type
        };
        
        const reminderId = await saveReminderToDB(reminderData);
        
        if (currentReminderBeingEdited) {
            // Update existing reminder in local state
            const index = reminders.findIndex(r => r.id === currentReminderBeingEdited);
            if (index !== -1) {
                reminders[index] = { ...reminderData, id: currentReminderBeingEdited };
            }
        } else {
            // Add new reminder to local state
            reminders.push({ ...reminderData, id: reminderId });
        }
        
        renderReminders();
        closeReminderEditor();
    } catch (error) {
        console.error("Error saving reminder:", error);
        showError("Failed to save reminder. Please try again.");
    }
}

function editReminder(reminderId) {
    if (!isAdmin) return;
    event.stopPropagation();
    openReminderEditor(reminderId);
}

async function deleteReminder(reminderId) {
    if (!isAdmin) return;
    if (confirm('Are you sure you want to delete this reminder?')) {
        try {
            await deleteReminderFromDB(reminderId);
            reminders = reminders.filter(r => r.id !== reminderId);
            renderReminders();
        } catch (error) {
            console.error("Error deleting reminder:", error);
            showError("Failed to delete reminder. Please try again.");
        }
    }
}

// POST EXPANSION FUNCTIONS (same as before)
function expandPost(postElement) {
    if (postElement.classList.contains('expanded')) return;
    
    if (expandedPost) {
        expandedPost.classList.remove('expanded');
        expandedPost.querySelector('.back-button')?.remove();
    }
    
    postElement.classList.add('expanded');
    expandedPost = postElement;
    
    const backButton = document.createElement('button');
    backButton.className = 'back-button';
    backButton.textContent = '← Back';
    backButton.addEventListener('click', (e) => {
        e.stopPropagation();
        collapsePost(postElement);
    });
    
    postElement.appendChild(backButton);
}

function collapsePost(postElement) {
    postElement.classList.remove('expanded');
    postElement.querySelector('.back-button')?.remove();
    expandedPost = null;
}

// UTILITY FUNCTIONS
function showError(message) {
    // You can implement a more sophisticated error display
    alert(message);
}

// Close modals when clicking outside
window.onclick = function(event) {
    if (event.target === announcementEditor) {
        closeAnnouncementEditor();
    }
    if (event.target === tabEditorModal) {
        closeTabEditor();
    }
    if (event.target === document.getElementById('reminder-editor')) {
        closeReminderEditor();
    }
};

// File upload handling
fileUploadInput.addEventListener('change', function() {
    if (!isAdmin) return;
    const files = Array.from(this.files);
    files.forEach(file => {
        uploadedFiles.push({ name: file.name });
        const fileItem = document.createElement('span');
        fileItem.innerHTML = `${file.name} <button class="remove-file" onclick="removeTempFile(this.parentNode, '${file.name}')">×</button>`;
        uploadedFilesDiv.appendChild(fileItem);
    });
});

    </script>

</body></html>
